<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <link rel="icon" type="image/x-icon" href="../image/DiscInLogo.png"/>
    <meta name="author" content="Ophelie Gavillet" content="Ugo Bismara"/>
    <meta name="description" content="Share your feedback and suggestions about the 2025 Disc In Camp, or report any inappropriate behavior to help us ensure a respectful and supportive environment for all participants."/>
    <meta name="keywords" content="disc in camp, camp 2025, ultimate frisbee, frisbee community, disc sport, ultimate team, frisbee family, competitive frisbee, team spirit, sports community, ultimate, frisbee, community, disc, sport, collective, family, camp, festival"/>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <title>Disc In Camp | Feedbacks</title>
    <link rel="stylesheet" href="../style/style.css"/>
    <link rel="stylesheet" href="../style/home.css"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Blinker:wght@100;200;300;400;600;700;800;900&family=Gabarito:wght@400..900&display=swap" rel="stylesheet">
  </head>
  <body>
     <!--Header-->
     <section class="header">
      <div id="guest-content">
        <a href="login.html" class="login-button">
          <p class="log-option">Login</p>
          <svg xmlns="http://www.w3.org/2000/svg" class="bi bi-person-circle" viewBox="0 0 16 16">
            <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
            <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/>
          </svg>
        </a>
      </div>
      <div id="user-content">
        <a href="#" class="login-button" id="my-profile-btn">
          <p class="log-option">My Profile</p>
          <svg xmlns="http://www.w3.org/2000/svg" class="bi bi-person-circle" viewBox="0 0 16 16">
            <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
            <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/>
          </svg>
        </a>
      </div>
        <a class="logo" href="../index.html">
            <img src="../image/DiscInLogo.png" alt="Logo" />
        </a>
    </section>
      
    <!--Main-->
    <main>
      <h1>FEEDBACKS</h1>
      <p class="center">Lost in the sauce last night? Spill the tea right here—we’re all ears for your feedback!</p>
      <section class="forms">
        <form id="feedbackForm">
            <label for="name">Name:</label>
            <input type="text" id="name" name="name" placeholder="Your Full Name" required autocomplete="name"><br>

            <label for="message">Message:</label>
            <textarea id="message" name="message" rows="6" placeholder="Your message ..." required autocomplete="off"></textarea><br>

            <button class="official" type="submit">SEND <svg xmlns="http://www.w3.org/2000/svg" width="0.8rem" height="0.8rem" fill="currentColor" class="bi bi-caret-right-fill" viewBox="0 0 16 16">
                <path d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"/>
            </svg></button>
        </form>
    </section>
    <div class="abuse">
      <p class="center" style="text-transform: uppercase;">Victim of <b class=green>malicious behavior</b>?<br>Go talk to the <a class="orange" href="#" id="showSafeTeam">Safe Team</a> directly or click the button bellow to directly <b class=green>alert</b> them.</p>
        <button class="official alert" id="reportIssueBtn">
            REPORT ISSUE
        </button>
    </div>

    <div id="safeTeamList" style="display:none;" class="safe-team-container"></div>

  </main>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCiy-xiOoMMgr4rwBKwGQRsA9fleX1_wT8",
        authDomain: "disc-in-camp.firebaseapp.com",
        databaseURL:
          "https://disc-in-camp-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "disc-in-camp",
        storageBucket: "disc-in-camp.appspot.com",
        messagingSenderId: "128937547779",
        appId: "1:128937547779:web:22677cb4478cffaf1a1636",
        measurementId: "G-Y4KZY16LFF",
      };
  firebase.initializeApp(firebaseConfig);
document.getElementById("feedbackForm").addEventListener("submit", function(event) {
            event.preventDefault(); 

            let formData = {
                name: document.getElementById("name").value,
                message: document.getElementById("message").value
            };

            fetch("https://script.google.com/macros/s/AKfycbzfxuRl2GSCS8M6qNSlELwyrvqw9IwTGn6ynqAMIadBMAFDhI7TJUdy-TNc78b7qDIa-A/exec", {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(formData)
            }).then(response => {
                alert("Feedback sent successfully !");
            }).catch(error => console.error("Error :", error));
        });

document.addEventListener("DOMContentLoaded", () => {
    const guestContent = document.getElementById("guest-content");
    const userContent = document.getElementById("user-content");
    const myProfileBtn = document.querySelector("#user-content a.login-button");

    // Vérifier l'état de connexion avec Firebase Auth
    firebase.auth().onAuthStateChanged((user) => {
        if (user) {
            // ✅ L'utilisateur est connecté, afficher "user-content"
            guestContent.style.display = "none";
            userContent.style.display = "block";
    myProfileBtn.addEventListener("click", function(event) {
    event.preventDefault();

    const user = firebase.auth().currentUser;

    if (user) {
      const userEmail = user.email;
      const db = firebase.database();

      db.ref('/players').orderByChild('mail').equalTo(userEmail).once('value')
        .then((snapshot) => {
          if (snapshot.exists()) {
            snapshot.forEach((childSnapshot) => {
              const playerData = childSnapshot.val();
              const role = playerData.role;

              // Redirection en fonction du rôle
              if (role === 'Player') {
                window.location.href = 'my-profile-player.html';
              } else if (role === 'Volunteer') {
                window.location.href = 'my-profile-volunteer.html';
              } else if (role === 'Coach') {
                window.location.href = 'my-profile-coach.html';
              } else {
                alert("Rôle non reconnu : " + role);
              }
            });
          } else {
            alert("Utilisateur non trouvé dans la base de données.");
          }
        })
        .catch((error) => {
          console.error("Erreur lors de la récupération des données utilisateur :", error);
          alert("Erreur de chargement : " + error.message);
        });
        } else {
          participantButtonsDiv.innerHTML = "<p>Participant not found!</p>";
        }
      });
        } else {
            // ❌ L'utilisateur est déconnecté, afficher "guest-content"
            guestContent.style.display = "block";
            userContent.style.display = "none";
        }
    });
});

document.addEventListener("DOMContentLoaded", () => {
    const reportIssueBtn = document.getElementById("reportIssueBtn");

    firebase.auth().onAuthStateChanged((user) => {
        if (user) {
            // ✅ Si connecté, activer le bouton
            reportIssueBtn.addEventListener("click", () => {
                window.location.href = "report-issue.html"; // Remplace par ta vraie page
            });
        } else {
            // ❌ Si pas connecté, afficher un message d'erreur
            reportIssueBtn.addEventListener("click", () => {
                alert("You must be logged in to report an issue. Please log in first.");
            });
        }
    });
});

document.getElementById("showSafeTeam").addEventListener("click", function(event) {
    event.preventDefault();

    const safeTeamListDiv = document.getElementById("safeTeamList");
    safeTeamListDiv.innerHTML = "<p>Loading Safe Team...</p>";
    safeTeamListDiv.style.display = "block";

    const db = firebase.database();
    db.ref('/players').once('value')
        .then(snapshot => {
            if (snapshot.exists()) {
                let listHTML = "<h3>Safe Team Members:</h3><ul style='list-style: none; padding: 0;'>";
                snapshot.forEach(childSnapshot => {
                    const player = childSnapshot.val();
                    const playerId = childSnapshot.key;
                    const activities = typeof player.activities === 'string' ? player.activities.toLowerCase() : "";

                    if (activities.includes('safe team')) {
                        listHTML += `
                            <li class="safe-team-list" style="margin: 5px 0;">
                                <span class="safe-team-member" data-id="${playerId}" style="color: #f97316; text-decoration: underline; cursor: pointer;">
                                    ${player.Name}
                                </span>
                            </li>
                        `;
                    }
                });
                listHTML += "</ul>";

                if (!listHTML.includes('<li')) {
                    safeTeamListDiv.innerHTML = "<p>No Safe Team members found.</p>";
                } else {
                    safeTeamListDiv.innerHTML = listHTML;

                  // 👉 Ajoute les événements de clic
                  document.querySelectorAll(".safe-team-member").forEach(elem => {
                      elem.addEventListener("click", () => {
                          const rawId = elem.getAttribute("data-id");
                          const parsed = parseInt(rawId, 10);
                          if (!isNaN(parsed)) {
                              const adjustedId = parsed + 1;
                              sessionStorage.setItem("participantId", adjustedId);
                              window.location.href = "participants.html";
                          } else {
                              console.error("Invalid data-id:", rawId);
                              alert("Erreur : impossible de récupérer l'ID du participant.");
                          }
                      });
                  });
                }
            } else {
                safeTeamListDiv.innerHTML = "<p>No players found in the database.</p>";
            }
        })
        .catch(error => {
            console.error("Error fetching Safe Team:", error);
            safeTeamListDiv.innerHTML = "<p>Error loading Safe Team members.</p>";
        });
  });
</script>

      <!--Footer-->
      <div class="navbar">
        <a href="../index.html" class="navbar-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="8vw" height="8vw" fill="currentColor" class="bi bi-house" viewBox="0 0 16 16">
            <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z"/>
          </svg>
          HOME
        </a>
        <a href="players.html" class="navbar-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="8vw" height="8vw" fill="currentColor" class="bi bi-people" viewBox="0 0 16 16">
            <path d="M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1zm-7.978-1L7 12.996c.001-.264.167-1.03.76-1.72C8.312 10.629 9.282 10 11 10c1.717 0 2.687.63 3.24 1.276.593.69.758 1.457.76 1.72l-.008.002-.014.002zM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4m3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0M6.936 9.28a6 6 0 0 0-1.23-.247A7 7 0 0 0 5 9c-4 0-5 3-5 4q0 1 1 1h4.216A2.24 2.24 0 0 1 5 13c0-1.01.377-2.042 1.09-2.904.243-.294.526-.569.846-.816M4.92 10A5.5 5.5 0 0 0 4 13H1c0-.26.164-1.03.76-1.724.545-.636 1.492-1.256 3.16-1.275ZM1.5 5.5a3 3 0 1 1 6 0 3 3 0 0 1-6 0m3-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4"/>
          </svg>
          PLAYERS
        </a>
        <a href="schedule.html" class="navbar-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="8vw" height="8vw" fill="currentColor" class="bi bi-calendar" viewBox="0 0 16 16">
            <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5M1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4z"/>
          </svg>
          SCHEDULE
        </a>
        <a href="feedback.html" class="navbar-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="8vw" height="8vw" fill="currentColor" class="bi bi-chat-square-text" viewBox="0 0 16 16">
            <path d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1h-2.5a2 2 0 0 0-1.6.8L8 14.333 6.1 11.8a2 2 0 0 0-1.6-.8H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h2.5a1 1 0 0 1 .8.4l1.9 2.533a1 1 0 0 0 1.6 0l1.9-2.533a1 1 0 0 1 .8-.4H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
            <path d="M3 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5M3 6a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 6m0 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5"/>
          </svg>
          FEEDBACK
        </a>
        <a href="news.html" class="navbar-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="8vw" height="8vw" fill="currentColor" class="bi bi-newspaper" viewBox="0 0 16 16">
            <path d="M0 2.5A1.5 1.5 0 0 1 1.5 1h11A1.5 1.5 0 0 1 14 2.5v10.528c0 .3-.05.654-.238.972h.738a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 1 1 0v9a1.5 1.5 0 0 1-1.5 1.5H1.497A1.497 1.497 0 0 1 0 13.5zM12 14c.37 0 .654-.211.853-.441.092-.106.147-.279.147-.531V2.5a.5.5 0 0 0-.5-.5h-11a.5.5 0 0 0-.5.5v11c0 .278.223.5.497.5z"/>
            <path d="M2 3h10v2H2zm0 3h4v3H2zm0 4h4v1H2zm0 2h4v1H2zm5-6h2v1H7zm3 0h2v1h-2zM7 8h2v1H7zm3 0h2v1h-2zm-3 2h2v1H7zm3 0h2v1h-2zm-3 2h2v1H7zm3 0h2v1h-2z"/>
          </svg>
          NEWS
        </a>
      </div>
    </body>
</html>